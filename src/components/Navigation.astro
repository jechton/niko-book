---
import { SITE_TITLE } from "$consts";
import { getCollection } from "astro:content";
const pathname = new URL(Astro.request.url).pathname.slice(1);
const allChapters = await getCollection("book");
allChapters.sort((a, b) => a.data.chapter - b.data.chapter);
const bookNumbers = allChapters.map((chapter) => chapter.data.book);
const uniqueBookNumbers = [...new Set(bookNumbers)];
uniqueBookNumbers.sort((a, b) => a - b);
---

<div class="drawer lg:drawer-open">
  <input id="my-drawer-3" type="checkbox" class="drawer-toggle" />
  <div class="drawer-content flex flex-col">
    <div class="navbar bg-neutral w-full">
      <div class="flex-none lg:hidden">
        <label
          for="my-drawer-3"
          aria-label="open sidebar"
          class="btn btn-square btn-ghost"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            class="inline-block h-6 w-6 stroke-current"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </label>
      </div>
      <a href="/" class="mx-2 flex-1 px-2">{SITE_TITLE}</a>
    </div>
    <div class="flex flex-col min-h-[calc(100lvh-4rem)] justify-between">
      <slot />
    </div>
  </div>
  <div class="drawer-side">
    <label for="my-drawer-3" aria-label="close sidebar" class="drawer-overlay"
    ></label>
    <ul class="menu bg-neutral w-80 min-h-full p-4">
      <li><a href="/">Home</a></li>
      <li>
        <details open>
          <summary>Books</summary>
          <ul>
            {
              uniqueBookNumbers.map((bookNum) => (
                <li>
                  <details open>
                    <summary>Book {bookNum}</summary>
                    <ul>
                      {allChapters
                        .filter((chapter) => chapter.data.book === bookNum)
                        .map((chapter) => (
                          <li>
                            <a href={`/book/${chapter.id}`}>
                              {chapter.data.title}
                            </a>
                          </li>
                        ))}
                    </ul>
                  </details>
                </li>
              ))
            }
          </ul>
        </details>
      </li>
    </ul>
  </div>
</div>
